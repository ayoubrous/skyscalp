import React, { useEffect, useRef, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { FaAngleDown, FaXmark } from 'react-icons/fa6';
import PlacesAutocomplete from 'react-places-autocomplete';
import {
    geocodeByAddress,
    geocodeByPlaceId,
    getLatLng,
} from 'react-places-autocomplete';

export default function HomeFilter() {
    const [t] = useTranslation();

    const categoryDropdownRef = useRef();
    const searchDropdownRef = useRef();

    const [showLocationDropdown, setShowLocationDropdown] = useState(false);
    const [showCategoriesDropdown, setShowCategoriesDropdown] = useState(false);
    const [selectedCategory, setSelectedCategory] = useState("")
    const [location, setLocation] = useState("")

    const categories = [
        "Excavators",
        "Bulldozers",
        "Cranes",
        "Loaders",
        "Backhoes",
        "Dump Trucks",
        "Pavers",
        "Residential",
        "Commercial",
        "Industrial",
        "Agricultural",
        "Vacant Land",
        "Rental",
        "Condominium",
        "Townhouse",
        "Multi-family",
    ]

    const handleClickOutside = (e) => {
        if (categoryDropdownRef.current && !categoryDropdownRef.current.contains(e.target)) {
            setShowLocationDropdown(false);
        }
        if (searchDropdownRef.current && !searchDropdownRef.current.contains(e.target)) {
            setShowCategoriesDropdown(false);
        }
    };

    const handleCategorySelect = category => {
        setShowCategoriesDropdown(false);
        setSelectedCategory(category)
        document.removeEventListener("mousedown", handleClickOutside);
    };

    const handleCategoryChange = e => {
        setShowCategoriesDropdown(true)
        setSelectedCategory(e.target.value)
    }

    useEffect(() => {
        document.addEventListener("mousedown", handleClickOutside);

        return () => {
            document.removeEventListener("mousedown", handleClickOutside);
        };
    }, []);


    const handleLocationSelect = async value => {
        // const results = await geocodeByAddress(value);
        // const latLng = await getLatLng(results[0]);
        setLocation(value);
        // setCoordinates(latLng);
    };

    return (
        <div className="filter-area">
            <div className="custom-container">
                <p className="color-primary mb-2">Looking for something?</p>
                <div className="filter hero-filter">
                    <div className="user-input">
                        <div className="search-input">
                            <input type="text" className="custom-input" placeholder='Try Excavator, Apartment, Cement' value={selectedCategory} onChange={handleCategoryChange}/>

                            <div className={`search-dropdown ${showCategoriesDropdown ? 'show' : ''}`} ref={searchDropdownRef}>
                                {
                                    categories.map((category, i) => {
                                        return (
                                            <p key={i} className="dropdown-item" onClick={() => handleCategorySelect(category)}>{category}</p>
                                        )
                                    })
                                }
                            </div>
                        </div>
                        <div className="category-list" onClick={() => setShowLocationDropdown(!showLocationDropdown)}>
                            <PlacesAutocomplete
                                value={location}
                                onChange={setLocation}
                                onSelect={handleLocationSelect}
                            >
                                {({ getInputProps, suggestions, getSuggestionItemProps, loading }) => (
                                    <div>

                                        <input className="custom-input location-input" {...getInputProps({ placeholder: "Type city" })} />

                                        <div className='category-dropdown show'>

                                            {suggestions.map(suggestion => {

                                                return (
                                                    <>
                                                        <div className='dropdown-item' {...getSuggestionItemProps(suggestion, {})}>
                                                            {suggestion.description}
                                                        </div>
                                                    </>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}
                            </PlacesAutocomplete>
                        </div>
                    </div>
                    <div className="filter-btn">
                        <button className="custom-btn">Search</button>
                    </div>
                </div>

            </div>
        </div>
    );
}
